{
  "action": "macro",
  "steps": [
    {
      "action": "run_python",
      "parameters": {
        "code": "import sqlite3\nconn = sqlite3.connect('history.sqlite')\ncursor = conn.cursor()\ncursor.execute(\"ALTER TABLE command_history ADD COLUMN context_guide TEXT\")\nconn.commit()\nconn.close()"
      },
      "comment": "‚ûï –î–æ–¥–∞—î –∫–æ–ª–æ–Ω–∫—É context_guide —É —Ç–∞–±–ª–∏—Ü—é command_history"
    },
    {
      "action": "update_code",
      "file_path": "gpt_agent_cache.py",
      "updates": [
        {
          "pattern": "INSERT INTO command_history \\(action, file_path, update_type\\)[\\s\\S]*?\\)",
          "replacement": "INSERT INTO command_history (action, file_path, update_type, context_guide) VALUES (?, ?, ?, ?)"
        },
        {
          "pattern": "cursor.execute\\(.*?\\)",
          "replacement": "cursor.execute(\"INSERT INTO command_history (action, file_path, update_type, context_guide) VALUES (?, ?, ?, ?)\", (\n    cmd.get(\"action\"),\n    cmd.get(\"file_path\") or cmd.get(\"filename\"),\n    cmd.get(\"update_type\"),\n    cmd.get(\"context_guide\", \"\")\n))"
        }
      ],
      "comment": "üß† –ó–±–µ—Ä—ñ–≥–∞—î context_guide –≤ –±–∞–∑—É –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –¥—ñ—ó"
    },
    {
      "action": "update_code",
      "file_path": "gpt_agent_cache.py",
      "updates": [
        {
          "pattern": "# üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ auto_feedback –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –¥—ñ—ó",
          "replacement": "# üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ auto_feedback –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –¥—ñ—ó\nif cmd.get('context_guide'): log_action('üß† –¶—ñ–ª—å –¥—ñ—ó: ' + cmd['context_guide'])"
        }
      ],
      "comment": "üß† –õ–æ–≥—É–≤–∞–Ω–Ω—è context_guide —É –ª–æ–≥–∞—Ö –¥—ñ–π"
    }
  ]
}
